@model IEnumerable<Team2_Project_WEB.Models.ItemVO>

@using Team2_Project_WEB.Models

@{
    ViewBag.Title = "제품별 거래량 조회";
    Layout = "~/Views/_LayoutPage.cshtml";
}

@section css{
    <!-- daterange picker -->
    <link rel="stylesheet" href="~/plugins/daterangepicker/daterangepicker.css">
}

<section class="content">
    <div class="container-fluid">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <form action="/Home/Item" method="get">
                        <div class="row" style="margin-bottom: 0px">
                            <div class="col-6 row">
                                <div class="col-2" style="padding-top:6px"><label>기간 조회</label></div>
                                <div class="input-group date col-5" id="datetimepicker1" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker1" placeholder="시작일" name="from" value=@ViewBag.FromDate />
                                    <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date col-5" id="datetimepicker2" data-target-input="nearest" ">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker2" placeholder="종료일" name="to" value=@ViewBag.ToDate />
                                    <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker">
                                        <div class="input-group-text">
                                            <i class="fa fa-calendar"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3"></div>
                            <div class="col-3">
                                <input type="submit" class="btn btn-block bg-gradient-success" value="조회">
                            </div>
                        </div>
                    </form>

                    <!-- 기존 DateRangePicker-->
                    @*<label for="dateRangeSelect" class="col-4 col-form-label">검색 기간 선택</label>
                        <div class="input-group col-8">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="far fa-calendar-alt"></i>
                                </span>
                            </div>
                            <input type="text" class="form-control float-right" id="dateRangeSelect">
                        </div>*@

                    <!--/.input group -->
                    <!-- 콤보박스로 기간선택-->
                    @*<label>Date range button:</label>
                        <div class="input-group">
                            <button type="button" class="btn btn-default float-right" id="daterange-btn">
                                <i class="far fa-calendar-alt"></i> Date range picker
                                <i class="fas fa-caret-down"></i>
                            </button>
                        </div>*@


                </div>
                <!-- /.card-header -->
                <!-- 목록 -->
                <div class="card-body table-responsive p-0">
                    <table class="table table-hover text-nowrap">
                        <thead>
                            <tr>
                                <th>제품명</th>
                                <th>제품코드</th>
                                <th>@ViewBag.ColText 주문량</th>
                                <th>@ViewBag.ColText 주문고객수</th>
                                <th>거래비율</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.Name</td>
                                    <td>@item.Code</td>
                                    <td>@item.OrderSum</td>
                                    <td>@item.CustomerSum</td>
                                    <td>@(item.Ratio.ToString("0.00")+" %")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <!-- /.card-body -->
            </div>
            <!-- /.card -->
        </div>

        <!-- /목록 -->
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <div class="card card-danger">
                    <div class="card-header">
                        <h3 class="card-title">제품별 거래총량</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="donutChart1" style="min-height: 300px; height: 300px; max-height: 300px; max-width: 100%; "></canvas>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>

            <div class="col-md-6">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">제품별 거래횟수</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="donutChart2" style="min-height: 300px; height: 300px; max-height: 300px; max-width: 100%; "></canvas>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
        </div>
    </div>
</section>

@{
    string name = ViewData["Name"].ToString();
    string orderSum = ViewData["OrderSum"].ToString();
    string customerSum = ViewData["CustomerSum"].ToString();
}

@section Scripts{
    <!-- ChartJS -->
    <script src="~/plugins/chart.js/Chart.min.js"></script>
    <!-- InputMask -->
    <script src="~/plugins/moment/moment.min.js"></script>
    <script src="~/plugins/inputmask/jquery.inputmask.min.js"></script>
    <!-- date-range-picker -->
    <script src="~/plugins/daterangepicker/daterangepicker.js"></script>
    <!-- Tempusdominus Bootstrap 4 -->
    <script src="~/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>

    <script>
        //Date range picker
        $('#dateRangeSelect').daterangepicker()
        //-------------
        //- DONUT CHART -
        //-------------
        // Get context with jQuery - using jQuery's .get() method.
        var donutChartCanvas1 = $('#donutChart1').get(0).getContext('2d')
        var donutChartCanvas2 = $('#donutChart2').get(0).getContext('2d')

        var names = "@name"
        var namearr = names.split(',')

        var donutData1 = {
            labels: namearr,
            datasets: [
                {
                    data: @orderSum,
                    backgroundColor: ['#f56954', '#00a65a', '#f39c12', '#00c0ef', '#3c8dbc', '#d2d6de'],
                }
            ]
        }
        var donutData2 = {
            labels: namearr,
            datasets: [
                {
                    data: @customerSum,
                    backgroundColor: ['#f56954', '#00a65a', '#f39c12', '#00c0ef', '#3c8dbc', '#d2d6de'],
                }
            ]
        }
        var donutOptions = {
            maintainAspectRatio: false,
            responsive: true,
        }
        //Create pie or douhnut chart
        // You can switch between pie and douhnut using the method below.
        new Chart(donutChartCanvas1, {
            type: 'doughnut',
            data: donutData1,
            options: donutOptions
        })

        new Chart(donutChartCanvas2, {
            type: 'doughnut',
            data: donutData2,
            options: donutOptions
        })

        //Date range as a button
        $('#daterange-btn').daterangepicker(
            {
                ranges: {
                    '최근 일주일': [moment().subtract(6, 'days'), moment()],
                    '최근 1개월': [moment().subtract(1, 'month'), moment()],
                    '최근 3개월': [moment().subtract(3, 'month'), moment()],
                    '최근 6개월': [moment().subtract(6, 'month'), moment()],
                    '최근 1년': [moment().subtract(1, 'month'), moment()]
                },
                startDate: moment().subtract(29, 'days'),
                endDate: moment()
            },
            function (start, end) {
                $('#reportrange span').html(start.format('YYYY - MMMM - D') + ' - ' + end.format('YYYY - MMMM - D'))
            }
        )

        $(function () {
            $('#datetimepicker1').datetimepicker({
                format: 'YYYY-MM-DD'
            });
            $('#datetimepicker2').datetimepicker({
                format: 'YYYY-MM-DD',
                useCurrent: false
            });
            $("#datetimepicker1").on("change.datetimepicker", function (e) {
                $('#datetimepicker2').datetimepicker('minDate', e.date);
            });
            $("#datetimepicker2").on("change.datetimepicker", function (e) {
                $('#datetimepicker1').datetimepicker('maxDate', e.date);
            });
        });

    </script>
}
